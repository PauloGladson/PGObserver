{% extends "baselayout.html" %}
{% set active_page = 'perfapi' %}
{% block body %}

<div id="reports" class="container_12">
    <div class="grid_12">
        <h3>Possible Sproc perf issues report</h3>
        <form method="GET" action="/perfapi">
            <span class="text3">Hostname:</span>
            <select name="hostname">
                <option value="all">all</option>
                {% for host_id, host in host_names: %}
                <option value="{{ host['host_name'] }}" {% if interval['hostname'] == host['host_name'] %} selected="selected" {% endif %}>{{ host['host_name'] }}</option>
                {% endfor %}
            </select>
            <br />
            <span class="text3">Api 1:</span>
            <input type="text" name="from" value="{{ interval['from'] }}">
            <br />
            <span class="text3">Api 2:</span>
            <input type="text" name="to" value="{{ interval['to'] }}">
            <input name="show" type="submit" value="show">
        </form>
    </div>
    <script>
        $(function() {
            $(".datefield").datepicker({"dateFormat": "yy-mm-dd"});
        });
    </script>
    <div class="clear"></div>
    <div class="grid_4">
        <table class="perftable" border="1">
            <tr>
                <th>Hostname</th>
                <th>Schema</th>
                <th>Sproc</th>
                <th>Calltime change %</th>
                <th>Share on total runtime %</th>
                <th>Avg1</th>
                <th>Avg2</th>
                <th>Callscount change %</th>
                <th>Calls1</th>
                <th>Calls2</th>
            </tr>
            {% for d in data: %}
            <tr>
                <td><a href="/{{ hosts[d['host_id']]['settings']['uiShortName'].lower().replace('-','') }}">{{ d['host_name'] }}</a></td>
                <td><a href="/sprocs/show/{{ d['host_id'] }}/{{ d['sproc_name'] }}">{{ d['sproc_schema'] }}</a></td>
                <td><a href="/sprocs/show/{{ d['host_id'] }}/{{ d['sproc_name'] }}">{{ d['sproc_name'] }}</a></td>
                <td>{{ d['calltime_change_pct'] }} ({{ d['allowed_runtime_growth_pct'] }})</td>
                <td>{{ d['share_on_total_runtime'] }} ({{ d['allowed_share_on_total_runtime_pct'] }})</td>
                <td>{{ d['execution_avg1'] }} </td>
                <td>{{ d['execution_avg2'] }} </td>
                <td>{{ d['callscount_change_pct'] }} </td>
                <td>{{ d['calls1'] }} </td>
                <td>{{ d['calls2'] }} </td>
            </tr>
            {% endfor %}
        </table>
    </div>
</div>

{% endblock %}